{      
    "title": "Interval",
    
    "processes": {

        "testInterval0": {
            "triggers": [
                { 
                    "condition": { "expr": ["not ${/proc/testInterval0/dmap/stop}"] },
                    "interval": { "expr": ["${/proc/testInterval0/dmap/interval}"] }
                }
            ],
            "dataMap": {
                "interval": { "type": "number", "default": 6.25 },
                "iterations": { "type": "number", "default": 1600 },
                "startTs": { "type": "number" },
                "ts": { "type": "number" },
                "drift": { "type": "number" },
                "simTime": { "type": "number" },
                "counter": { "type": "number" },   
                "warmup": { "type": "number", "default": 3000 },                          
                "cntBias": { "type": "number" },                        
                "avg": { "type": "number" },
                "stop": { "type": "boolean" }
            },
            "instructions": [
                {
                    "move": {
                        "from": { "math": { "expr": ["${/dt/unix}"]}},
                        "to": { "pointer": ["/proc/testInterval0/dmap/ts"] }
                    }
                },
                {
                    "ifelse": {
                        "if": {
                            "condition": { "expr": ["${/proc/testInterval0/dmap/cntBias} < 1"] },
                            "instructions": [
                                {
                                    "move": {
                                        "from": { "math": { "expr": ["${/proc/testInterval0/dmap/warmup}",
                                            " / ${/proc/testInterval0/dmap/interval}"] }},
                                        "to": { "pointer": ["/proc/testInterval0/dmap/cntBias"] }
                                    }
                                }
                            ]
                        }
                    }
                },
                {
                    "move": {
                        "from": { "math": { "expr": ["${/proc/testInterval0/dmap/counter} + 1"] }},
                        "to": { "pointer": ["/proc/testInterval0/dmap/counter"] }
                    }
                },
                {
                    "ifelse": {
                        "if": {
                            "condition": { "expr": ["${/proc/testInterval0/dmap/counter}",
                                                    " > ${/proc/testInterval0/dmap/cntBias}",
                                                    " and ${/proc/testInterval0/dmap/startTs} == 0"] },
                            "instructions": [
                                {
                                    "move": {
                                        "from": { "pointer": ["/proc/testInterval0/dmap/ts"] },
                                        "to": { "pointer": ["/proc/testInterval0/dmap/startTs"] }
                                    }
                                }
                            ]
                        },
                        "elif": [
                            {
                                "condition": { "expr": ["${/proc/testInterval0/dmap/counter}",
                                    " > (${/proc/testInterval0/dmap/iterations}",
                                    " + ${/proc/testInterval0/dmap/cntBias})"] },
                                "instructions": [
                                    {
                                        "move": {
                                            "from": { "math": { "expr": ["(${/proc/testInterval0/dmap/ts} - ${/proc/testInterval0/dmap/startTs})"] }},
                                            "to": { "pointer": ["/proc/testInterval0/dmap/simTime"] }
                                        }
                                    },
                                    {
                                        "move": {
                                            "from": { "math": { "expr": ["${/proc/testInterval0/dmap/simTime} / ${/proc/testInterval0/dmap/iterations}"] }},
                                            "to": { "pointer": ["/proc/testInterval0/dmap/avg"] }
                                        }
                                    },
                                    {
                                        "move": {
                                            "from": { "math": { "expr": ["${/proc/testInterval0/dmap/simTime} - (${/proc/testInterval0/dmap/iterations} * ${/proc/testInterval0/dmap/interval})"] }},
                                            "to": { "pointer": ["/proc/testInterval0/dmap/drift"] }
                                        }
                                    },
                                    {
                                        "move": {
                                            "from": { "compound": true },
                                            "to": { "pointer": ["/proc/testInterval0/dmap/stop"] }
                                        }
                                    },                          
                                    { "log": ["3:\nTarget interval: ${/proc/testInterval0/dmap/interval}",
                                        "\nIterations: ${/proc/testInterval0/dmap/iterations}",
                                        "\nActual sim. time: ${/proc/testInterval0/dmap/simTime}",
                                        "\nActual avg. interval: ${/proc/testInterval0/dmap/avg}",
                                        "\nDrift: ${/proc/testInterval0/dmap/drift}"] }
                                ]
                            }
                        ]
                    }
                }
            ]
        }
    }
}
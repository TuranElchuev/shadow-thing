# Virtual Thing Description Specification

# Contents:

- [Introduction](#introduction)
- [Definitions](#definitions)
- [Architecture](#architecture)
- [Components](#components)
    - [Main Components](#main-components)
        - [VirtualThingModel](#virtualthingmodel)
        - [DataHolder](#dataholder)
        - [Process](#process)
        - [Property](#property)
        - [Action](#action)
        - [Event](#event)
        - [Sensor](#sensor)
        - [Actuator](#actuator)
    - [Instructions](#instructions)
        - [Instruction](#instruction)
        - [Empty](#empty)
        - [Fake](#fake)
        - [Control](#control)
        - [Move](#move)
        - [Ifelse](#ifelse)
        - [Switch](#switch)
        - [Try](#try)
        - [Loop](#loop)
        - [ReadProperty](#readproperty)
        - [WriteProperty](#writeproperty)
        - [ObserveProperty](#observeproperty)
        - [UnobserveProperty](#unobserveproperty)
        - [InvokeAction](#invokeaction)
        - [EmitEvent](#emitEvent)
        - [SubscribeEvent](#subscribeevent)
        - [UnsubscribeEvent](#unsubscribeEvent)
        - [InvokeProcess](#invokeProcess)
        - [Log](#log)
        - [Info](#info)
        - [Warn](#warn)
        - [Debug](#debug)
        - [Error](#error)
    - [Helper Components](#helper-components)
        - [CompoundData](#compoundData)
        - [DateTime](#dateTime)
        - [Delay](#delay)
        - [File](#file)
        - [Interval](#interval)
        - [Math](#math)
        - [Pointer](#pointer)
        - [ParameterizedString](#parameterizedstring)
        - [Trigger](#trigger)
        - [ValueSource](#valuesource)
        - [ValueTarget](#valuetarget)
- [Console message reference](#console-message-reference)
- [Developer notes](#developer-notes)


# Introduction

# Definitions

### Virtual Thing Engine
the program that `interpretes` and `executes` [Virtual Thing Description][vtd] instances.

### Virtual Thing Process

# Architecture

# Components

## Main Components




### VirtualThingModel
The root object in the [Virtual Thing Description][vtd].

#### Schema

Extends [Thing][td_thing] with the following differences:
- the mandatory properties of [Thing][td_thing] are not mandatory
- the overriden properties are: `properties`, `actions` and `events`
- there are additional properties (in the table below).

| Property | Description | Mandatory | Type | Default |
|----------|-------------|:---------:|------|:-------:|
| properties | Property affordances. | | Map of [Property](#property) | |
| actions | Action affordances. | | Map of [Action](#action) | |
| events | Event affordances. | | Map of [Event](#event) | |
| sensors | Sensor description entries. | | Map of [Sensor](#sensor) | |
| actuators | Actuator description entries. | | Map of [Actuator](#actuator) | |
| dataMap | Value entries: variables, constants, etc. | | Map of [DataHolder](#dataholder) | |
| processes | Processes. | | Map of [Process](#process) | |
| dataSchemas | Reusable schemas for [DataHolder](#dataholder) entries. | | Map of [DataHolder](#dataholder) | |




### DataHolder
All value instances, i.e. variables, constants, etc.

#### Schema

Extends [DataSchema][td_dataSchema] with the following differences:
- the properties that are irrelevant for data validation are ignored by the [Engine][engine]
- there are additional properties (in the table below).

| Property | Description | Mandatory | Type | Default |
|----------|-------------|:---------:|------|:-------:|
| default | Default value to initialize. | | any | |
| fake | Indicates whether the value should be faked. Faking the value means, that each `read` operation performed by the [Engine][engine] on the corresponding `DataHolder instance` will return a new random value in compliance with the schema of that instance. | | `boolean` | false |
| schema | A valid name of a `reusable data schema` (an entry from `dataSchemas` map in [VirtualThingModel](#VirtualThingModel)). If specified, the properties of the `reusable data schema` will be inherited, but will **not** overwrite the alredy existing properties with matching names. | | `string` | |

#### Initialize/reset value
For an arbitrary combination of the *root* properties of a `DataHolder instance`, its initialization/reset behavior is defined by the following table:
|Priority|Root property|Property's value|Initial/reset value|Access rights|Remark|
|:------:|:--:|:--------:|-------------------|:--------:|------|
|1|const|any|Property's value|RO||
|2|fake|true|Generated by [json-schema-faker][json-faker].|RO|Each `read operation` performed by the [Engine][engine] will reset the value.|
|3|type|any valid|Instantiated by [json-schema-instantiator][json-inst].|R/W||
|4|default|any|Property's value|R/W||
|5|-|-|undefined|R/W||



    
### Process
A component that can be `executed` by the [Engine][engine] as a sequence of instructions to perform the described behavior.

#### Schema
Type: `object`
| Property | Description | Mandatory | Type | Default |
|----------|-------------|:---------:|------|:-------:|
|triggers|Triggers define when the process should be invoked automatically. Further ways of invoking a process are described in corresponding sections.||Array of [Trigger](#trigger)||
|condition|A process can execute only if its condition (if any) is met.||[Math](#math)||
|instructions|Instructions that will be executed in a sequence when the process is invoked.|yes|Array of [Instruction](#instruction)||
|dataMap|Variables, constants, etc. that can be used by the instructions of the process. Instructions are not limited to the dataMap of their process, and can access any dataMap defined anywhere else within the [Virtual Thing Description][vtd]. The decision where to place variables/constants is the matter of structuring.||Map of [DataHolder](#dataholder)||
|comment|A property to use on your own purpose, ignored by the [Engine][engine].||`string` or `array of string`||
**\*** additional properties are not allowed.



### Property
### Action
### Event
### Sensor
### Actuator

## Instructions

### Instruction
### Empty
### Fake
### Control
### Move
### Ifelse
### Switch
### Try
### Loop
### ReadProperty
### WriteProperty
### ObserveProperty
### UnobserveProperty
### InvokeAction
### EmitEvent
### SubscribeEvent
### UnsubscribeEvent
### InvokeProcess
### Log
### Info
### Warn
### Debug
### Error

## Helper Components

### CompoundData
### DateTime
### Delay
### File
### Interval
### Math
### Pointer
### ParameterizedString
### Trigger
### ValueSource
### ValueTarget

# Console message reference

# Developer notes


[vtd]: #virtual-thing-description
[engine]: #virtual-thing-engine

[json-inst]: https://www.npmjs.com/package/json-schema-instantiator
[json-faker]: https://www.npmjs.com/package/json-schema-faker

[td]: https://www.w3.org/TR/wot-thing-description/

[td_thing]: https://www.w3.org/TR/wot-thing-description/#thing
[td_dataSchema]: https://www.w3.org/TR/wot-thing-description/#dataschema
[td_property]: https://www.w3.org/TR/wot-thing-description/#propertyaffordance
[td_action]: https://www.w3.org/TR/wot-thing-description/#actionaffordance
[td_event]: https://www.w3.org/TR/wot-thing-description/#eventaffordance